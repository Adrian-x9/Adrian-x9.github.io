<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gra w Unikanie</title>
    <style>
        body {
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            color: #fff;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .game-container {
            position: relative;
            background-color: #222;
            width: 100vw;
            height: 100vw;
            max-width: 600px;
            max-height: 600px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            animation: fadeIn 1s ease-in-out;
            overflow: hidden;
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.7);
            text-align: center;
            transition: opacity 0.5s ease-in-out;
            padding: 20px;
            box-sizing: border-box;
        }

        .game-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .game-title {
            font-size: clamp(2rem, 5vw, 4rem);
            margin-bottom: 1rem;
            color: #fff;
            text-shadow: 0 0 10px #fff;
        }

        .game-text {
            font-size: clamp(1rem, 2vw, 1.5rem);
            color: #ccc;
        }
        
        .game-text.game-over-screen {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .game-over-title {
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            color: #f00;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(255, 0, 0, 0.8);
            margin: 0 0 20px 0; /* Mniejszy odstęp pod napisem */
        }
        
        .game-over-text {
            font-size: clamp(1.2rem, 2.5vw, 2rem);
            color: #ccc;
        }

        .final-score-value {
            color: #f00;
            font-weight: bold;
        }

        .game-button {
            padding: 1rem 2rem;
            font-size: clamp(1rem, 2vw, 1.5rem);
            font-weight: bold;
            color: #fff;
            background-color: #f00;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
            margin-top: 20px; /* Większy odstęp przed przyciskiem */
        }

        .game-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.8);
        }

        .score-display {
            position: absolute;
            top: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0 20px;
            box-sizing: border-box;
            font-size: clamp(1rem, 2.5vw, 2rem);
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .score-left, .score-right {
            display: flex;
            align-items: baseline;
            gap: 5px;
        }
        
        .score-number {
            font-size: clamp(1.5rem, 3.5vw, 2.5rem);
        }

        .score-label.light {
            color: #aaa;
            font-weight: normal;
            font-size: clamp(0.9rem, 2vw, 1.2rem);
        }
        
        .score-number.high-score {
            color: #f00;
        }
    </style>
</head>
<body>

<div class="game-container">
    <canvas id="gameCanvas"></canvas>
    <div id="gameOverlay" class="game-overlay">
        <h1 class="game-title">Unikaj przeszkód</h1>
        <p class="game-text">Kliknij lub dotknij ekran, aby poruszyć kwadratem.<br>Unikaj przeszkód, aby przetrwać!</p>
        <button id="startButton" class="game-button">Start</button>
    </div>
    <div class="score-display">
        <div class="score-left">
            <span class="score-number" id="scoreValue">0</span>
            <span class="score-label light">Wynik</span>
        </div>
        <div class="score-right">
            <span class="score-label light">Top</span>
            <span class="score-number high-score" id="highScoreValue">0</span>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const startButton = document.getElementById('startButton');
    const gameOverlay = document.getElementById('gameOverlay');
    const scoreValue = document.getElementById('scoreValue');
    const highScoreValue = document.getElementById('highScoreValue');

    let gameLoop;
    let player;
    let obstacles = [];
    let score = 0;
    let highScore = 0;
    let isGameOver = false;
    let lastTime = 0;
    const obstacleSpawnInterval = 500; // in ms
    let nextObstacleSpawn = 0;
    let touchX = 0;

    // Responsive canvas resizing
    function resizeCanvas() {
        const size = Math.min(window.innerWidth, window.innerHeight);
        canvas.width = canvas.height = Math.min(size * 0.9, 600);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Player object
    function Player() {
        this.size = 20;
        this.x = canvas.width / 2;
        this.y = canvas.height - 50;
        this.speed = 8;

        this.draw = function() {
            ctx.fillStyle = 'red';
            ctx.shadowColor = 'rgba(255, 0, 0, 0.8)';
            ctx.shadowBlur = 10;
            ctx.beginPath();
            ctx.moveTo(this.x - this.size / 2, this.y + this.size / 2);
            ctx.lineTo(this.x + this.size / 2, this.y + this.size / 2);
            ctx.lineTo(this.x, this.y - this.size / 2);
            ctx.closePath();
            ctx.fill();
            ctx.shadowBlur = 0;
        };

        this.update = function(touchX) {
            if (Math.abs(this.x - touchX) > this.speed) {
                this.x += this.speed * Math.sign(touchX - this.x);
            } else {
                this.x = touchX;
            }
            if (this.x < this.size / 2) this.x = this.size / 2;
            if (this.x > canvas.width - this.size / 2) this.x = canvas.width - this.size / 2;
        };
    }

    // Obstacle object
    function Obstacle() {
        this.size = Math.random() * (40 - 20) + 20;
        this.x = Math.random() * (canvas.width - this.size);
        this.y = -this.size;
        this.speed = Math.random() * (4 - 2) + 2;
        this.color = `hsl(0, 0%, ${Math.random() * (60 - 30) + 30}%)`;

        this.draw = function() {
            ctx.fillStyle = this.color;
            ctx.shadowColor = 'rgba(255, 255, 255, 0.5)';
            ctx.shadowBlur = 5;
            ctx.fillRect(this.x, this.y, this.size, this.size);
            ctx.shadowBlur = 0;
        };

        this.update = function() {
            this.y += this.speed;
        };
    }

    // Game logic
    function initGame() {
        isGameOver = false;
        score = 0;
        obstacles = [];
        player = new Player();
        touchX = player.x; // Initialize touch position
        
        // Load high score from localStorage
        const storedHighScore = localStorage.getItem('avoidanceGameHighScore');
        if (storedHighScore) {
            highScore = parseInt(storedHighScore, 10);
        }
        highScoreValue.textContent = highScore;
        scoreValue.textContent = score;
        
        gameOverlay.innerHTML = `<h1 class="game-title">Unikaj przeszkód</h1>
                                <p class="game-text">Kliknij lub dotknij ekran, aby poruszyć kwadratem.<br>Unikaj przeszkód, aby przetrwać!</p>
                                <button id="startButton" class="game-button">Start</button>`;
        document.getElementById('startButton').addEventListener('click', initGame);
        gameOverlay.classList.add('hidden');
        lastTime = performance.now();
        gameLoop = requestAnimationFrame(animate);
    }

    function animate(timestamp) {
        if (isGameOver) {
            cancelAnimationFrame(gameLoop);
            gameOverlay.classList.remove('hidden');

            // Update high score if new score is higher
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('avoidanceGameHighScore', highScore);
            }
            highScoreValue.textContent = highScore;
            
            // Generate the Game Over screen with new formatting
            gameOverlay.innerHTML = `
                <div class="game-text game-over-screen">
                    <h2 class="game-over-title">Game Over!</h2>
                    <p class="game-over-text">Wynik: <span class="final-score-value">${score}</span></p>
                </div>
                <button id="startButton" class="game-button">Kliknij, aby zagrać ponownie</button>
            `;
            document.getElementById('startButton').addEventListener('click', initGame);
            
            return;
        }

        const deltaTime = timestamp - lastTime;
        lastTime = timestamp;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Player update and draw
        player.update(touchX);
        player.draw();

        // Spawn obstacles
        nextObstacleSpawn -= deltaTime;
        if (nextObstacleSpawn <= 0) {
            obstacles.push(new Obstacle());
            nextObstacleSpawn = obstacleSpawnInterval - (score * 2);
            if (nextObstacleSpawn < 100) nextObstacleSpawn = 100;
        }

        // Obstacle updates and collision detection
        for (let i = obstacles.length - 1; i >= 0; i--) {
            const obstacle = obstacles[i];
            obstacle.update();
            obstacle.draw();

            // Collision detection
            const playerRect = { x: player.x - player.size / 2, y: player.y - player.size / 2, width: player.size, height: player.size };
            const obstacleRect = { x: obstacle.x, y: obstacle.y, width: obstacle.size, height: obstacle.size };

            if (playerRect.x < obstacleRect.x + obstacleRect.width &&
                playerRect.x + playerRect.width > obstacleRect.x &&
                playerRect.y < obstacleRect.y + obstacleRect.height &&
                playerRect.y + playerRect.height > obstacleRect.y) {
                isGameOver = true;
            }

            // Remove off-screen obstacles and increase score
            if (obstacle.y > canvas.height) {
                obstacles.splice(i, 1);
                score++;
                scoreValue.textContent = score;
            }
        }

        requestAnimationFrame(animate);
    }

    // Event listeners for control
    canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        touchX = e.clientX - rect.left;
    });

    canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        touchX = e.touches[0].clientX - rect.left;
    });

    // Start screen logic
    window.onload = function() {
        const storedHighScore = localStorage.getItem('avoidanceGameHighScore');
        if (storedHighScore) {
            highScore = parseInt(storedHighScore, 10);
        }
        highScoreValue.textContent = highScore;
        
        // Initial setup for the start button
        gameOverlay.innerHTML = `<h1 class="game-title">Unikaj przeszkód</h1>
                                <p class="game-text">Kliknij lub dotknij ekran, aby poruszyć kwadratem.<br>Unikaj przeszkód, aby przetrwać!</p>
                                <button id="startButton" class="game-button">Start</button>`;
        document.getElementById('startButton').addEventListener('click', initGame);
        gameOverlay.classList.remove('hidden');
    }
</script>

</body>
</html>
